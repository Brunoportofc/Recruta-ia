generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Candidato {
  id                    String        @id @default(uuid()) @db.Uuid
  linkedinId            String?       @unique @map("linkedin_id")
  email                 String        @unique
  nomeCompleto          String        @map("nome_completo")
  telefone              String?
  cidade                String?
  estado                String?       @db.VarChar(2)
  linkedinUrl           String?       @map("linkedin_url")
  fotoPerfilUrl         String?       @map("foto_perfil_url")
  createdAt             DateTime      @default(now()) @map("created_at")
  updatedAt             DateTime      @updatedAt @map("updated_at")
  candidaturas          Candidatura[]

  @@index([email])
  @@index([linkedinId])
  @@index([createdAt])
  @@map("candidatos")
}

model Vaga {
  id                    String        @id @default(uuid()) @db.Uuid
  empresaId             String        @map("empresa_id") @db.Uuid
  jobTitle              String        @map("job_title")
  jobTitleType          String        @default("text") @map("job_title_type")
  company               String
  companyType           String        @default("text") @map("company_type")
  workplace             String
  location              Json          // Formato Unipile: { id: "103119278", text: "São Paulo - SP" }
  description           String        @db.Text
  employmentStatus      String?       @map("employment_status")
  
  // Salário
  salaryAmount          Float?        @map("salary_amount")
  salaryMin             Float?        @map("salary_min")
  salaryMax             Float?        @map("salary_max")
  salaryAnonymous       Boolean       @default(false) @map("salary_anonymous")
  
  // Configurações da vaga (testes, entrevistas, etc)
  jobConfig             Json          @default("{}") @map("job_config")
  
  // Campos opcionais do recruiter (para quando a integração com Unipile estiver pronta)
  recruiterProject      String?       @map("recruiter_project")
  recruiterProjectType  String?       @map("recruiter_project_type")
  recruiterFunctions    Json?         @map("recruiter_functions")
  recruiterIndustries   Json?         @map("recruiter_industries")
  recruiterSeniority    String?       @map("recruiter_seniority")
  recruiterApplyUrl     String?       @map("recruiter_apply_url")
  recruiterConfig       Json?         @map("recruiter_config")
  
  // Metadados
  status                String        @default("rascunho")
  linkedinUrl           String?       @map("linkedin_url")
  unipileId             String?       @unique @map("unipile_id")
  errorMessage          String?       @map("error_message")
  createdAt             DateTime      @default(now()) @map("created_at")
  updatedAt             DateTime      @updatedAt @map("updated_at")
  
  // Relações
  empresa               Empresa       @relation(fields: [empresaId], references: [id])
  candidaturas          Candidatura[]

  @@index([empresaId])
  @@index([createdAt])
  @@index([workplace])
  @@index([company])
  @@index([status])
  @@index([unipileId])
  @@map("vagas")
}

model Candidatura {
  id                    String    @id @default(uuid()) @db.Uuid
  candidatoId           String    @map("candidato_id") @db.Uuid
  vagaId                String    @map("vaga_id") @db.Uuid
  status                String    @default("analise_curriculo")
  curriculoSnapshot     Json      @map("curriculo_snapshot")
  testeResultado        Json?     @map("teste_resultado")
  notasInternas         String?   @map("notas_internas")
  feedbackCandidato     String?   @map("feedback_candidato")
  dataCandidatura       DateTime  @default(now()) @map("data_candidatura")
  dataUltimaAtualizacao DateTime  @updatedAt @map("data_ultima_atualizacao")
  dataFinalizacao       DateTime? @map("data_finalizacao")
  origemAplicacao       String    @default("plataforma") @map("origem_aplicacao")
  candidato             Candidato @relation(fields: [candidatoId], references: [id], onDelete: Cascade)
  vaga                  Vaga      @relation(fields: [vagaId], references: [id], onDelete: Cascade)

  @@unique([candidatoId, vagaId])
  @@index([candidatoId])
  @@index([vagaId])
  @@index([status])
  @@index([dataCandidatura])
  @@map("candidaturas")
}

model Empresa {
  id             String    @id @default(uuid()) @db.Uuid
  nome           String
  email          String    @unique
  senha          String    // Hash da senha para autenticação
  cnpj           String?   @unique
  telefone       String
  ramoAtuacao    String    @map("ramo_atuacao")
  tamanhoEmpresa String    @map("tamanho_empresa")
  website        String?
  localizacao    String
  descricao      String?   @db.Text
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")

  // Relações
  vagas          Vaga[]

  @@index([email])
  @@map("empresas")
}
