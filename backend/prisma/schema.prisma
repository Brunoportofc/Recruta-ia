generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Candidato {
  id                    String        @id @default(uuid()) @db.Uuid
  linkedinId            String?       @unique @map("linkedin_id")
  email                 String        @unique
  nomeCompleto          String        @map("nome_completo")
  telefone              String?
  cidade                String?
  estado                String?       @db.VarChar(2)
  linkedinUrl           String?       @map("linkedin_url")
  fotoPerfilUrl         String?       @map("foto_perfil_url")
  objetivoProfissional  String?       @map("objetivo_profissional")
  origemDados           String?       @map("origem_dados")
  perfilCompleto        Boolean       @default(false) @map("perfil_completo")
  createdAt             DateTime      @default(now()) @map("created_at")
  updatedAt             DateTime      @updatedAt @map("updated_at")
  certificacoes         Json          @default("[]")
  experiencias          Json          @default("[]")
  formacoes             Json          @default("[]")
  habilidades           Json          @default("[]")
  idiomas               Json          @default("[]")
  testesComportamentais Json          @default("[]") @map("testes_comportamentais")
  candidaturas          Candidatura[]

  @@index([email])
  @@index([linkedinId])
  @@index([createdAt])
  @@map("candidatos")
}

model Job {
  id                                     String        @id @default(uuid()) @db.Uuid
  jobTitle                               String        @map("job_title")
  jobTitleType                           String        @map("job_title_type")
  company                                String
  companyType                            String        @map("company_type")
  workplace                              String
  location                               String
  description                            String
  employmentStatus                       String?       @map("employment_status")
  autoRejectionTemplate                  String?       @map("auto_rejection_template")
  screeningQuestions                     Json          @default("[]") @map("screening_questions")
  recruiterProject                       String        @map("recruiter_project")
  recruiterProjectType                   String        @map("recruiter_project_type")
  recruiterFunctions                     Json          @default("[]") @map("recruiter_functions")
  recruiterIndustries                    Json          @default("[]") @map("recruiter_industries")
  recruiterSeniority                     String        @map("recruiter_seniority")
  recruiterApplyMethodType               String        @map("recruiter_apply_method_type")
  recruiterApplyMethodNotificationEmail  String?       @map("recruiter_apply_method_notification_email")
  recruiterApplyMethodResumeRequired     Boolean       @default(true) @map("recruiter_apply_method_resume_required")
  recruiterApplyMethodUrl                String?       @map("recruiter_apply_method_url")
  recruiterIncludePosterInfo             Boolean       @default(true) @map("recruiter_include_poster_info")
  recruiterTrackingPixelUrl              String?       @map("recruiter_tracking_pixel_url")
  recruiterCompanyJobId                  String?       @map("recruiter_company_job_id")
  recruiterAutoArchiveScreeningQuestions Boolean       @default(true) @map("recruiter_auto_archive_screening_questions")
  recruiterAutoArchiveOutsideCountry     Boolean       @default(true) @map("recruiter_auto_archive_outside_country")
  recruiterSendRejectionNotification     Boolean       @default(true) @map("recruiter_send_rejection_notification")
  createdAt                              DateTime      @default(now()) @map("created_at")
  updatedAt                              DateTime      @updatedAt @map("updated_at")
  errorMessage                           String?       @map("error_message")
  linkedinUrl                            String?       @map("linkedin_url")
  status                                 String        @default("syncing")
  unipileId                              String?       @unique @map("unipile_id")
  candidaturas                           Candidatura[]

  @@index([createdAt])
  @@index([workplace])
  @@index([company])
  @@index([status])
  @@index([unipileId])
  @@map("jobs")
}

model Candidatura {
  id                    String    @id @default(uuid()) @db.Uuid
  candidatoId           String    @map("candidato_id") @db.Uuid
  jobId                 String    @map("job_id") @db.Uuid
  status                String    @default("analise_curriculo")
  curriculoSnapshot     Json      @map("curriculo_snapshot")
  testeResultado        Json?     @map("teste_resultado")
  notasInternas         String?   @map("notas_internas")
  feedbackCandidato     String?   @map("feedback_candidato")
  dataCandidatura       DateTime  @default(now()) @map("data_candidatura")
  dataUltimaAtualizacao DateTime  @updatedAt @map("data_ultima_atualizacao")
  dataFinalizacao       DateTime? @map("data_finalizacao")
  origemAplicacao       String    @default("plataforma") @map("origem_aplicacao")
  candidato             Candidato @relation(fields: [candidatoId], references: [id], onDelete: Cascade)
  job                   Job       @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([candidatoId, jobId])
  @@index([candidatoId])
  @@index([jobId])
  @@index([status])
  @@index([dataCandidatura])
  @@map("candidaturas")
}

model Empresa {
  id             String    @id @default(uuid()) @db.Uuid
  nome           String
  email          String    @unique
  senha          String    // Hash da senha para autenticação
  cnpj           String?   @unique
  telefone       String
  ramoAtuacao    String    @map("ramo_atuacao")
  tamanhoEmpresa String    @map("tamanho_empresa")
  website        String?
  localizacao    String
  descricao      String?   @db.Text
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")

  @@index([email])
  @@map("empresas")
}
